generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =======================
// User
// =======================
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products  Product[]
  orders    Order[]
  addresses ShippingAddress[]
  cartItems CartItem[]
}

// =======================
// Product
// =======================
model Product {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String
  category    String
  image       String[] // matches TS: product.image
  price       Int
  offerPrice  Int

  orders    OrderItem[]
  user      User        @relation(fields: [userId], references: [id])
  cartItems CartItem[]

  @@index([userId])
}

// =======================
// CartItem
// =======================
model CartItem {
  id        String @id @default(cuid())
  userId    String
  productId String
  quantity  Int    @default(1)

  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@index([userId])
  @@index([productId])
}

// =======================
// Order
// =======================
model Order {
  id                String  @id @default(cuid())
  userId            String
  shippingAddressId String?

  amount         Int
  isPaid         Boolean  @default(false)
  shippingMethod String
  orderDate      DateTime @default(now())

  user            User             @relation(fields: [userId], references: [id])
  shippingAddress ShippingAddress? @relation(fields: [shippingAddressId], references: [id])
  items           OrderItem[]

  @@index([userId])
}

// =======================
// OrderItem (for multiple products per order)
// =======================
model OrderItem {
  id        String @id @default(cuid())
  orderId   String
  productId String
  quantity  Int

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

// =======================
// ShippingAddress
// =======================
model ShippingAddress {
  id     String @id @default(cuid())
  userId String

  fullName    String
  phoneNumber String
  zipcode     String
  area        String
  city        String
  state       String // matches TS Address
  province    String? // optional for extra info

  orders Order[]
  user   User    @relation(fields: [userId], references: [id])

  @@index([userId])
}
